# 彩色空间互转

## 简介

色彩空间可以看作是物理上的光谱分布到线性空间上的投影。同样的线性空间，选取的基底不同最终表现的形式、能力和方便程度也会不同。为了不同的用途和目的，很多图像算法需要将图像的彩色空间进行转换。
    
## 色彩空间介绍

### RGB
RGB是最常见的颜色空间，以红绿蓝三色作为线性空间上的三个基。在24位真彩图像中，每个像素的红绿蓝各占一个字节，总共24位存储空间，可表现2^24中颜色。

在RGB颜色空间中，所有颜色都可以看作三种基本颜色的混合：

        C = α(R) + β(G) + γ(B)
        
其中α、β、γ是红绿蓝三种成分的比例，即三色系数。

在部分应用中，有时只考虑R、G、B之间的比例关系，这时候可以使用规范化RGB颜色空间：

        r = α/(α+β+γ)
        g = β/(α+β+γ)
        b = γ/(α+β+γ)
        
r g b为色度坐标


### CMY

CMY颜色空间以青、品红、黄为三基色，与RGB随着三原色值增大不断变亮不同，CMY与之相反，因此又称为减色色彩空间。

在使用规范化色彩空间时，RGB与CMY之间的对应关系为：

        [C, M, Y] = [1, 1, 1] - [R, G, B]

### HSV/HSI

HSV时根据色调、饱和度、明度/亮度建立的色彩空间

H：色调。色调用某颜色点和强度轴连线与红颜色轴的角度表示，反应了改颜色最接近红光的程度，或者其波长与红光谱波长之间的差值。

S：饱和度。颜色的纯度，可以用于区分颜色的深浅，混入的白光越少，饱和度越高，颜色越鲜明。

V：亮度。表示颜色的明亮程度。

RGB到HSI空间的转换：

    假设RGB空间中任意颜色的三个分量为R G B,并且已经归一化，那么改颜色在HSI空间中的归一化坐标可以这么计算：
        
        I = (R + G + B) / sqrt(3)
        
        S = 1 - 3*min(R, G, B)/(R + G + B)
        
       θ = 1 / cos(((R - G) + (R - B))/(2*sqrt((R - G)**2 + (R - B)(G - B))))
       
        H = θ if G >= B else 2*pi-θ 

HSI到RGB：

1、0 <= H <= 120时：

    R = 1/sqrt(3) * (1 + S*cos(H)/cos(60-H))
    B = 1/sqrt(3) * (1 - S)
    G = sqrt(3)*I - R - B
    
2、120 <= H <= 240时：

    R = 1/sqrt(3) * (1 + S*cos(H-120)/cos(180-H))
    B = 1/sqrt(3) * (1 - S)
    G = sqrt(3)*I - R - B
    
3、240 <= H <= 300时：

    R = 1/sqrt(3) * (1 + S*cos(H-240)/cos(300-H))
    B = 1/sqrt(3) * (1 - S)
    G = sqrt(3)*I - R - B

### YCbCr

参考链接：https://blog.csdn.net/u010186001/article/details/52800250

主要的采样格式有YCbCr 4:2:0、YCbCr 4:2:2、YCbCr 4:1:1和 YCbCr 4:4:4。其中YCbCr 4:1:1 比较常用，其含义为：每个点保存一个 8bit 的亮度值(也就是Y值), 每 2 x 2 个点保存一个 Cr和Cb值, 图像在肉眼中的感觉不会起太大的变化。所以, 原来用 RGB(R,G,B 都是 8bit unsigned) 模型, 每个点需要 8x3=24 bits， 而现在仅需要 8+(8/4)+(8/4)=12bits, 平均每个点占12bits。这样就把图像的数据压缩了一半。

YCbCr转RGB（ITU.BT-601标准）

<div align=center><img src="https://img-blog.csdn.net/20161012193045900"/></div>
<div align=center><img src="https://img-blog.csdn.net/20161012193325724"/></div>

       Y = 0.299 R + 0.587 G + 0.114 B
       Cb = -0.1687 R - 0.3313 G + 0.5 B + 128
       Cr = 0.5 R - 0.4187 G - 0.0813 B + 128
    
       R = Y + 1.402 (Cr-128)
       G= Y - 0.34414 (Cb-128) - 0.71414 (Cr-128)
       B= Y + 1.772 (Cb-128)
       
下边的各个符号都带了一撇，表示该符号在原值基础上进行了伽马校正，伽马校正有助于弥补在抗锯齿的过程中，线性分配伽马值所带来的细节损失，使图像细节更加丰富。在没有采用伽马校正的情况下，暗部细节不容易显现出来，而采用了这一图像增强技术以后，图像的层次更加明晰了。
    
        Y’ = 0.257*R' + 0.504*G' + 0.098*B' + 16
        Cb' = -0.148*R' - 0.291*G' + 0.439*B' + 128
        Cr' = 0.439*R' - 0.368*G' - 0.071*B' + 128
        R' = 1.164*(Y’-16) + 1.596*(Cr'-128)
        G' = 1.164*(Y’-16) - 0.813*(Cr'-128) - 0.392*(Cb'-128)
        B' = 1.164*(Y’-16) + 2.017*(Cb'-128)

### YUV

YUV 使用RGB的信息，但它从全彩色图像中产生一个黑白图像，然后提取出三个主要的颜色变成两个额外的信号来描述颜色。把这三个信号组合回来就可以产生一个全彩色图像。
Y 通道描述 Luma 信号，它与亮度信号有一点点不同，值的范围介于亮和暗之间。 Luma 是黑白电视可以看到的信号。U (Cb) 和 V (Cr) 通道从红 (U) 和蓝 (V) 中提取亮度值来减少颜色信息量。这些值可以从新组合来决定红，绿和蓝的混合信号。

<div align=center><img src="https://img-blog.csdn.net/20161012193045900"/></div>
<div align=center><img src="https://img-blog.csdn.net/20161012193045900"/></div>

YUV与RGB转换：

        Y'= 0.299*R' + 0.587*G' + 0.114*B'
        U'= -0.147*R' - 0.289*G' + 0.436*B' = 0.492*(B'- Y')
        V'= 0.615*R' - 0.515*G' - 0.100*B' = 0.877*(R'- Y')
        R' = Y' + 1.140*V'
        G' = Y' - 0.394*U' - 0.581*V'
        B' = Y' + 2.032*U'

### 灰度化方法
RGB彩色图像可以通过下面的公式转为256个灰度等级的灰度图像：

    Gray(i, j) = R * 0.299 + G * 0.587 + B * 0.114
